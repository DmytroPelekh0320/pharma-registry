<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Пошук лікарських засобів</title>

    <!-- Tom Select -->
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>

    <style>
        select {
            width: 400px;
        }
    </style>
</head>
<body>
    <h2>Пошук лікарських засобів</h2>
    <form id="sourceForm" method="POST" action="{{ url_for('set_source') }}">
    <label for="source">Обрати джерело даних:</label>
    <select name="source" id="source" onchange="this.form.submit()">
        <option value="ukraine" {% if source == 'ukraine' %}selected{% endif %}>Український реєстр</option>
        <option value="poland" {% if source == 'poland' %}selected{% endif %}>Польський реєстр</option>
    </select>
</form>
<br>
    <form id="searchForm">
        <label for="name">Назва препарату:</label><br>
        <select id="name" name="name">
            <option value="">Усі</option>
            {% for n in names %}
                <option value="{{ n }}">{{ n }}</option>
            {% endfor %}
        </select><br><br>

        <label for="form">Форма випуску:</label><br>
        <select id="form" name="form">
            <option value="">Усі</option>
            {% for f in forms %}
                <option value="{{ f }}">{{ f }}</option>
            {% endfor %}
        </select><br><br>

        <label for="inn">МНН:</label><br>
        <select id="inn" name="inn">
            <option value="">Усі</option>
            {% for i in inns %}
                <option value="{{ i }}">{{ i }}</option>
            {% endfor %}
        </select><br><br>

        <label for="country">Країна виробника:</label><br>
        <select id="country" name="country">
            <option value="">Усі</option>
            {% for c in countries %}
                <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
        </select><br><br>

        <label for="atc">ATC-група (4 символи):</label><br>
        <select id="atc" name="atc">
            <option value="">Усі</option>
            {% for a in atc_codes %}
                <option value="{{ a }}">{{ a }}</option>
            {% endfor %}
        </select><br><br>

        <button type="submit">Пошук</button>
    </form>

    <div id="results"></div>

    {% if not guest %}
        <a href="{{ url_for('charts') }}">Перейти до графіків</a><br><br>
        <form id="saveForm" action="{{ url_for('save_results') }}" method="post">
            <input type="hidden" name="results" id="resultsInput">
            <button type="submit">Зберегти результати</button>
        </form>
        <a href="{{ url_for('history') }}">Переглянути історію</a>
    {% else %}
        <button disabled>Зберегти результати (доступно після входу)</button>
    {% endif %}

    <!-- Скрипти -->
    <script src="{{ url_for('static', filename='js/search.js') }}"></script>
    <script>
        // ініціалізація Tom Select
        ["name", "form", "inn", "country", "atc"].forEach(id => {
            new TomSelect(`#${id}`, {
                create: false,
                maxItems: 1,
                allowEmptyOption: true,
                openOnFocus: true,
                maxOptions: 1000
            });
        });
    </script>
</body>
</html>
